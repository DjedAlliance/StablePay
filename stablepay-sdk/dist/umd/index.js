!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("djed-sdk"),require("react"),require("viem")):"function"==typeof define&&define.amd?define(["djed-sdk","react","viem"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).StablePay=t(e.DjedSdk,e.React,e.viem)}(this,function(e,t,n){"use strict";const a={sepolia:{uri:"https://ethereum-sepolia.publicnode.com/",chainId:11155111,djedAddress:"0x624FcD0a1F9B5820c950FefD48087531d38387f4",tokens:{stablecoin:{symbol:"SOD",address:"0x6b930182787F346F18666D167e8d32166dC5eFBD",decimals:18,isDirectTransfer:!0},native:{symbol:"ETH",decimals:18,isNative:!0}},feeUI:0},"milkomeda-mainnet":{uri:"https://rpc-mainnet-cardano-evm.c1.milkomeda.com",chainId:2001,djedAddress:"0x67A30B399F5Ed499C1a6Bc0358FA6e42Ea4BCe76",tokens:{stablecoin:{symbol:"MOD",address:"0xcbA90fB1003b9D1bc6a2b66257D2585011b004e9",decimals:18,isDirectTransfer:!0},native:{symbol:"mADA",decimals:18,isNative:!0}},feeUI:0},"ethereum-classic":{uri:"https://rpc.mordor.etccooperative.org",chainId:63,djedAddress:"0xD4548F4b6d08852B56cdabC6be7Fd90953179d68",tokens:{stablecoin:{symbol:"ECSD",address:"0xffD4505B3452Dc22f8473616d50503bA9E1710Ac",decimals:18,isDirectTransfer:!0},native:{symbol:"ETC",decimals:18,isNative:!0}},feeUI:0},"ethereum-classic-mainnet":{uri:"https://etc.rivet.link",chainId:61,djedAddress:"0xCc3664d7021FD36B1Fe2b136e2324710c8442cCf",tokens:{stablecoin:{symbol:"ECSD",address:"0x5A7Ca94F6E969C94bef4CE5e2f90ed9d4891918A",decimals:18,isDirectTransfer:!0},native:{symbol:"ETC",decimals:18,isNative:!0}},feeUI:0}};class r{constructor(e,t){this.networkUri=e,this.djedAddress=t}async init(){if(!this.networkUri||!this.djedAddress)throw new Error("Network URI and DJED address are required");try{this.web3=await e.getWeb3(this.networkUri),this.djedContract=e.getDjedContract(this.web3,this.djedAddress);const{stableCoin:t,reserveCoin:n}=await e.getCoinContracts(this.djedContract,this.web3),{scDecimals:a,rcDecimals:r}=await e.getDecimals(t,n);this.stableCoin=t,this.reserveCoin=n,this.scDecimals=a,this.rcDecimals=r,this.oracleContract=await e.getOracleAddress(this.djedContract).then(t=>e.getOracleContract(this.web3,t,this.djedContract._address)),this.oracleAddress=this.oracleContract._address,console.log("Transaction initialized successfully")}catch(e){throw console.error("Error initializing transaction:",e),e}}getBlockchainDetails(){return{web3Available:!!this.web3,djedContractAvailable:!!this.djedContract,stableCoinAddress:this.stableCoin?this.stableCoin._address:"N/A",reserveCoinAddress:this.reserveCoin?this.reserveCoin._address:"N/A",stableCoinDecimals:this.scDecimals,reserveCoinDecimals:this.rcDecimals,oracleAddress:this.oracleAddress||"N/A",oracleContractAvailable:!!this.oracleContract}}async handleTradeDataBuySc(t){if(!this.djedContract)throw new Error("DJED contract is not initialized");if("string"!=typeof t)throw new Error("Amount must be a string");try{return(await e.tradeDataPriceBuySc(this.djedContract,this.scDecimals,t)).totalBCScaled}catch(e){throw console.error("Error fetching trade data for buying stablecoins: ",e),e}}async buyStablecoins(t,n,a){if(!this.djedContract)throw new Error("DJED contract is not initialized");try{console.log(`Building stablecoin purchase transaction from ${t} to ${n} with value ${a}`);const r="0x0232556C83791b8291E9b23BfEa7d67405Bd9839",o=await e.buyScTx(this.djedContract,t,n,a,r,this.djedAddress);return console.log("Transaction built:",o),o}catch(e){throw console.error("Error executing buyStablecoins transaction: ",e),e}}}var o="main_stablePayButton__UA7HC",i="main_logo__ITyEy",s="main_buttonText__N-ewy";const l=({onClick:e,size:n="medium"})=>{const a={small:{width:"200px",height:"50px",fontSize:"14px"},medium:{width:"250px",height:"60px",fontSize:"16px"},large:{width:"300px",height:"70px",fontSize:"18px"}},r={small:{width:"35px",height:"33px"},medium:{width:"40px",height:"38px"},large:{width:"45px",height:"43px"}},l=a[n]||a.medium,c=r[n]||r.medium;return t.createElement("button",{className:o,onClick:e,style:l},t.createElement("div",{className:i,style:c}),t.createElement("span",{className:s},"Pay with StablePay"))};var c={dialogOverlay:"PricingCard_dialogOverlay__0XJrE",pricingCard:"PricingCard_pricingCard__LrWb9",small:"PricingCard_small__J4CHj",medium:"PricingCard_medium__EVmTB",large:"PricingCard_large__A6pnX",dialogClose:"PricingCard_dialogClose__jJ1tM",pricingCardHeader:"PricingCard_pricingCardHeader__wGczA",allianceLogo:"PricingCard_allianceLogo__URa-U",stablepayTitle:"PricingCard_stablepayTitle__4t848",pricingCardBody:"PricingCard_pricingCardBody__0wKQn",selectField:"PricingCard_selectField__LBPoZ",transactionReview:"PricingCard_transactionReview__Ix-eL",transactionInfo:"PricingCard_transactionInfo__Ck-Rc",transactionLabel:"PricingCard_transactionLabel__GDux7",transactionValue:"PricingCard_transactionValue__q-xxp",infoSection:"PricingCard_infoSection__gyjMQ",infoIcon:"PricingCard_infoIcon__rraxD",infoText:"PricingCard_infoText__l4b7A",walletButton:"PricingCard_walletButton__llw4v",loading:"PricingCard_loading__2-tGA",error:"PricingCard_error__m5fK-",networkError:"PricingCard_networkError__zR-36",errorText:"PricingCard_errorText__qZRJt","message-box":"PricingCard_message-box__vkUKy",detailsButton:"PricingCard_detailsButton__jHglL",errorDetails:"PricingCard_errorDetails__CzN-7",loadingContainer:"PricingCard_loadingContainer__6nOVa",spinner:"PricingCard_spinner__9ucQv",spin:"PricingCard_spin__24tni"};const d=({children:e,onClose:n,size:a="medium"})=>t.createElement("div",{className:c.dialogOverlay},t.createElement("div",{className:`${c.pricingCard} ${c[a]}`},t.createElement("button",{className:c.dialogClose,onClick:n},"×"),t.createElement("div",{className:c.pricingCardHeader},t.createElement("div",{className:c.allianceLogo}),t.createElement("h2",{className:c.stablepayTitle},"StablePay")),t.createElement("div",{className:c.pricingCardBody},e)));class u{constructor(e){this.networkSelector=e,this.selectedToken=null}selectToken(e){const t=this.networkSelector.getSelectedNetworkConfig();return!(!t||!t.tokens[e])&&(this.selectedToken={key:e,...t.tokens[e]},!0)}getSelectedToken(){return this.selectedToken}getAvailableTokens(){const e=this.networkSelector.getSelectedNetworkConfig();return e?Object.entries(e.tokens).map(([e,t])=>({key:e,...t})):[]}resetSelection(){this.selectedToken=null}}const m=t.createContext(),h=({children:e,networkSelector:n})=>{const[a]=t.useState(()=>new u(n)),[r,o]=t.useState(null),[i,s]=t.useState(null),[l,c]=t.useState(null),d=()=>{s(null),c(null)};return t.useEffect(()=>{o(n.selectedNetwork)},[n.selectedNetwork]),t.createElement(m.Provider,{value:{networkSelector:n,tokenSelector:a,selectedNetwork:r,selectedToken:i,transactionDetails:l,setTransactionDetails:c,selectNetwork:e=>!!n.selectNetwork(e)&&(o(e),d(),!0),selectToken:e=>{if(a.selectToken(e)){const e=a.getSelectedToken();return s(e),!0}return!1},resetSelections:()=>{n.selectNetwork(null),o(null),d()}}},e)},g=()=>{const e=t.useContext(m);if(void 0===e)throw new Error("useNetwork must be used within a NetworkProvider");return e},w=()=>{const{networkSelector:e,selectedNetwork:n,selectNetwork:a}=g();return t.createElement("div",{className:c.selectField},t.createElement("label",{htmlFor:"network-select"},"Select Network"),t.createElement("select",{id:"network-select",onChange:e=>{a(e.target.value)},value:n||""},t.createElement("option",{value:"",disabled:!0},"Select a network"),Object.keys(e.availableNetworks).map(e=>t.createElement("option",{key:e,value:e},e))))},k=()=>{const{networkSelector:e,tokenSelector:n,selectedNetwork:a,selectedToken:o,selectToken:i,setTransactionDetails:s}=g(),[l,d]=t.useState(!1),[u,m]=t.useState(null),h=a?n.getAvailableTokens():[];return t.createElement("div",{className:c.selectField},t.createElement("label",{htmlFor:"token-select"},"Select Token"),t.createElement("select",{id:"token-select",onChange:async t=>{const o=t.target.value;m(null),d(!0);try{if(i(o)){const t=e.getSelectedNetworkConfig(),i=new r(t.uri,t.djedAddress);await i.init();const l=e.getTokenAmount(o),c=i.getBlockchainDetails();let d=null;"native"===o&&(d=await i.handleTradeDataBuySc(String(l))),s({network:a,token:o,tokenSymbol:n.getSelectedToken().symbol,amount:l,receivingAddress:e.getReceivingAddress(),djedContractAddress:t.djedAddress,isDirectTransfer:n.getSelectedToken().isDirectTransfer||!1,isNativeToken:n.getSelectedToken().isNative||!1,tradeAmount:d?d.amount:null,...c})}}catch(e){console.error("Error fetching transaction details:",e),m("Failed to fetch transaction details. Please try again.")}finally{d(!1)}},value:o?o.key:"",disabled:!a||l},t.createElement("option",{value:"",disabled:!0},a?l?"Loading...":"Select a token":"Please select a network first"),h.map(e=>t.createElement("option",{key:e.key,value:e.key},e.symbol," (",e.isDirectTransfer?"Direct Transfer":"Native",")"))),u&&t.createElement("div",{className:c.error},u))},C=n.defineChain({id:63,name:"Mordor Testnet",network:"mordor",nativeCurrency:{decimals:18,name:"Mordor Ether",symbol:"METC"},rpcUrls:{default:{http:["https://rpc.mordor.etccooperative.org"],webSocket:["wss://rpc.mordor.etccooperative.org/ws"]}},blockExplorers:{default:{name:"BlockScout",url:"https://blockscout.com/etc/mordor"}},testnet:!0}),b=t.createContext(null),p=({children:e})=>{const[a,r]=t.useState(null),[o,i]=t.useState(null),[s,l]=t.useState(null),[c,d]=t.useState(null),[u,m]=t.useState(null),[h,g]=t.useState(null),[w,k]=t.useState(!1),p=C.id,f=t.useCallback(async()=>{if(!window.ethereum)return g("Please install MetaMask or another Web3 wallet"),!1;k(!0),g(null);try{const e=await window.ethereum.request({method:"eth_requestAccounts"});if(0===e.length)throw new Error("No wallet address found. Please unlock your wallet.");const t=await window.ethereum.request({method:"eth_chainId"}),a=parseInt(t,16);if(a!==p)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${p.toString(16)}`}]})}catch(e){if(4902!==e.code)throw new Error("Please switch to Mordor Testnet in MetaMask");try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${p.toString(16)}`,chainName:"Mordor Testnet",nativeCurrency:{name:"Mordor ETC",symbol:"METC",decimals:18},rpcUrls:["https://rpc.mordor.etccooperative.org"],blockExplorerUrls:["https://etc-mordor.blockscout.com/"]}]})}catch(e){throw new Error("Failed to add Mordor Testnet to MetaMask")}}const o=n.createWalletClient({chain:C,transport:n.custom(window.ethereum)});r(o),l(e[0]),d(a);const i=n.createPublicClient({chain:C,transport:n.http()}),s=await i.getBalance({address:e[0]});return m(parseFloat(s)/Math.pow(10,18)),window.ethereum.on("accountsChanged",_),window.ethereum.on("chainChanged",y),!0}catch(e){return console.error("Error connecting wallet:",e),g(e.message),!1}finally{k(!1)}},[]),v=t.useCallback(()=>{i(n.createPublicClient({chain:C,transport:n.http()}))},[]),y=async e=>{const t=parseInt(e,16);if(d(t),t===p){if(window.ethereum){const e=n.createWalletClient({chain:C,transport:n.custom(window.ethereum)});r(e)}}else g("Wrong network detected. Please switch to Mordor Testnet")},_=async e=>{if(0===e.length)E();else{l(e[0]);const t=n.createPublicClient({chain:C,transport:n.http()}),a=await t.getBalance({address:e[0]});m(parseFloat(a)/Math.pow(10,18))}},E=t.useCallback(()=>{r(null),l(null),d(null),m(null),window.ethereum&&(window.ethereum.removeListener("accountsChanged",_),window.ethereum.removeListener("chainChanged",y))},[]);return t.useEffect(()=>{v()},[v]),t.createElement(b.Provider,{value:{walletClient:a,publicClient:o,account:s,chainId:c,balance:u,error:h,isConnecting:w,connectWallet:f,disconnectWallet:E}},e)},f=({onTransactionComplete:e})=>{const{networkSelector:a,selectedNetwork:o,selectedToken:i,transactionDetails:s,setTransactionDetails:l}=g(),{connectWallet:d,account:u,walletClient:m,publicClient:h,isConnecting:w}=(()=>{const e=t.useContext(b);if(!e)throw new Error("useWallet must be used within a WalletProvider");return e})(),[k,C]=t.useState(null),[p,f]=t.useState(null),[v,y]=t.useState(null),[_,E]=t.useState(""),[S,T]=t.useState(null),[N,A]=t.useState(null),[D,x]=t.useState(!1);if(t.useEffect(()=>{(async()=>{if(o&&i)try{const e=a.getSelectedNetworkConfig(),t=a.getReceivingAddress(),n=a.getTokenAmount(i.key),s=new r(e.uri,e.djedAddress);await s.init(),C(s);let c=null;if("native"===i.key)try{c=await s.handleTradeDataBuySc(String(n)),f(c)}catch(e){console.error("Error fetching trade data:",e)}l({network:o,token:i.key,tokenSymbol:i.symbol,amount:n||"0",receivingAddress:t,djedContractAddress:e.djedAddress,isDirectTransfer:i.isDirectTransfer||!1,isNativeToken:i.isNative||!1,tradeAmount:c?c.amount:null,...s.getBlockchainDetails()})}catch(e){console.error("Error initializing transaction:",e)}})()},[o,i,a,l]),!s)return t.createElement("div",{className:c.loading},"Initializing transaction...");return t.createElement("div",{className:c.transactionReview},t.createElement("div",{className:c.transactionInfo},t.createElement("span",{className:c.transactionLabel},"Network:"),t.createElement("span",{className:c.transactionValue},s.network)),t.createElement("div",{className:c.transactionInfo},t.createElement("span",{className:c.transactionLabel},"You Pay:"),t.createElement("span",{className:c.transactionValue},"stablecoin"===i.key?`${s.amount} ${s.tokenSymbol}`:`${p||"Calculating..."} ${s.tokenSymbol}`)),t.createElement("button",{className:c.walletButton,onClick:async()=>{await d()&&console.log("Wallet connected:",u)},disabled:w},w?"Connecting...":"Connect Wallet"),u&&!v&&t.createElement("button",{className:c.walletButton,onClick:async()=>{if(u&&s&&k)try{E("⏳ Preparing transaction...");const e=s.receivingAddress;let t;if("native"===i.key){const a="0x0232556C83791b8291E9b23BfEa7d67405Bd9839",r=p||"0";t=await k.buyStablecoins(u,e,n.parseEther(String(r)),a)}else{const a=s.amount?n.parseUnits(String(s.amount),s.stableCoinDecimals):"0";t={to:"0xdc86935A9597aA3A9008d2f26232233043091284",data:n.encodeFunctionData({abi:[{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}],functionName:"transfer",args:[e,a]}),account:u}}y(t),E("✅ Transaction ready! Click 'Send Transaction' to proceed.")}catch(e){A(e),E("❌ Transaction preparation failed.")}else E("❌ Wallet not connected or transaction details missing")}},"Prepare Transaction"),u&&v&&t.createElement("button",{className:c.walletButton,onClick:async()=>{try{if(!m||!u||!v)return void E("❌ Wallet client, account, or transaction data is missing");E("⏳ Sending transaction...");const t=await m.sendTransaction({...v,account:u});T(t),E("✅ Transaction sent!"),e&&e({txHash:t,network:o,token:i?.key,tokenSymbol:i?.symbol,amount:s?.amount,receivingAddress:s?.receivingAddress})}catch(e){A(e),E("❌ Transaction failed.")}},disabled:null!==S},"Send Transaction"),_&&t.createElement("div",{className:"message-box"},_,N&&t.createElement("button",{onClick:()=>x(!D),className:c.detailsButton},D?"Hide Details":"Show Details")),D&&N&&t.createElement("div",{className:c.errorDetails},t.createElement("pre",null,N.message)),S&&t.createElement("div",{className:c.transactionLink},"✅ Transaction Hash:"," ",t.createElement("a",{href:`https://blockscout.com/etc/mordor/tx/${S}`,target:"_blank",rel:"noopener noreferrer",className:c.explorerLink,style:{color:"#007bff",textDecoration:"underline",fontWeight:"bold",cursor:"pointer",wordBreak:"break-word"}},S.slice(0,6),"...",S.slice(-6))))},v=({onClose:e,buttonSize:n,onTransactionComplete:a})=>{const{resetSelections:r}=g();return t.createElement(d,{onClose:()=>{r(),e()},size:n},t.createElement(w,null),t.createElement(k,null),t.createElement(f,{onTransactionComplete:a}))},y=({onClose:e,buttonSize:n,networkSelector:a,onTransactionComplete:r})=>t.createElement(h,{networkSelector:a},t.createElement(p,null,t.createElement(v,{onClose:e,buttonSize:n,onTransactionComplete:r})));return{NetworkSelector:class{constructor(e){this.merchantConfig=e,this.blacklist=e.getBlacklist(),this.availableNetworks=this.getAvailableNetworks(),this.selectedNetwork=null}getAvailableNetworks(){return Object.entries(a).reduce((e,[t,n])=>(this.blacklist.includes(n.chainId)||(e[t]=n),e),{})}selectNetwork(e){return null===e?(this.selectedNetwork=null,console.log("Network selection reset"),!0):this.availableNetworks[e]?(this.selectedNetwork=e,console.log(`Network selected: ${e}`),!0):(console.error(`Invalid network: ${e}`),!1)}getSelectedNetworkConfig(){return this.selectedNetwork?this.availableNetworks[this.selectedNetwork]:null}getReceivingAddress(){return this.merchantConfig.getReceivingAddress()}getTokenAmount(e){return this.merchantConfig.getTokenAmount(this.selectedNetwork,e)}},Transaction:r,Config:class{constructor(e={}){this.receivingAddress=e.receivingAddress||"",this.blacklist=e.blacklist||[],this.amounts=e.Amounts||{},this.validateConfig()}validateConfig(){if(!this.receivingAddress)throw new Error("Receiving address is required");for(const[e,t]of Object.entries(this.amounts)){if(!a[e])throw new Error(`Invalid network: ${e}`);if(!t.stablecoin||"number"!=typeof t.stablecoin||t.stablecoin<=0)throw new Error(`Invalid stablecoin amount for network ${e}`)}}getBlacklist(){return this.blacklist}getReceivingAddress(){return this.receivingAddress}getTokenAmount(e){console.log("Getting amount for network:",e),console.log("Amounts object:",this.amounts);const t=this.amounts[e]?.stablecoin;return console.log("Returning amount:",t),t||0}},Widget:({networkSelector:e,buttonSize:n="medium",onTransactionComplete:a,onSuccess:r})=>{const[o,i]=t.useState(!1),s=a||r;return t.createElement("div",{className:c.widgetContainer},!o&&t.createElement(l,{onClick:()=>{i(!0)},size:n}),o&&t.createElement(y,{onClose:()=>{i(!1)},buttonSize:n,networkSelector:e,onTransactionComplete:s}))},PayButton:l,Dialog:d,NetworkDropdown:w}});
//# sourceMappingURL=index.js.map
