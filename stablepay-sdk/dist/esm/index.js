import{getWeb3 as e,getDjedContract as t,getCoinContracts as n,getDecimals as r,getOracleAddress as a,getOracleContract as o,tradeDataPriceBuySc as i,buyScTx as s}from"djed-sdk";import c,{useContext as l,createContext as d,useState as m,useEffect as u,useRef as h,useCallback as w}from"react";import{defineChain as k,createWalletClient as g,custom as C,createPublicClient as p,http as b,parseEther as f,parseUnits as v,encodeFunctionData as E}from"viem";import{sepolia as y}from"viem/chains";const _={sepolia:{uri:"https://ethereum-sepolia.publicnode.com/",chainId:11155111,djedAddress:"0x624FcD0a1F9B5820c950FefD48087531d38387f4",tokens:{stablecoin:{symbol:"SOD",address:"0x6b930182787F346F18666D167e8d32166dC5eFBD",decimals:18,isDirectTransfer:!0},native:{symbol:"ETH",decimals:18,isNative:!0}},feeUI:0},"milkomeda-mainnet":{uri:"https://rpc-mainnet-cardano-evm.c1.milkomeda.com",chainId:2001,djedAddress:"0x67A30B399F5Ed499C1a6Bc0358FA6e42Ea4BCe76",tokens:{stablecoin:{symbol:"MOD",address:"0xcbA90fB1003b9D1bc6a2b66257D2585011b004e9",decimals:18,isDirectTransfer:!0},native:{symbol:"mADA",decimals:18,isNative:!0}},feeUI:0},"ethereum-classic":{uri:"https://etc.rivet.link",chainId:61,djedAddress:"0xCc3664d7021FD36B1Fe2b136e2324710c8442cCf",tokens:{stablecoin:{symbol:"ECSD",address:"0x5A7Ca94F6E969C94bef4CE5e2f90ed9d4891918A",decimals:18,isDirectTransfer:!0},native:{symbol:"ETC",decimals:18,isNative:!0}},feeUI:0}};class N{constructor(e,t){this.networkUri=e,this.djedAddress=t}async init(){if(!this.networkUri||!this.djedAddress)throw new Error("Network URI and DJED address are required");try{this.web3=await e(this.networkUri),this.djedContract=t(this.web3,this.djedAddress);try{const{stableCoin:e,reserveCoin:t}=await n(this.djedContract,this.web3),{scDecimals:i,rcDecimals:s}=await r(e,t);this.stableCoin=e,this.reserveCoin=t,this.scDecimals=i,this.rcDecimals=s,this.oracleContract=await a(this.djedContract).then((e=>o(this.web3,e,this.djedContract._address))),this.oracleAddress=this.oracleContract._address}catch(e){if(console.error("[Transaction] Error fetching contract details:",e),e.message&&e.message.includes("execution reverted")){const e=e=>e.includes("milkomeda")?{name:"Milkomeda",chainId:"2001"}:e.includes("mordor")?{name:"Mordor Testnet",chainId:"63"}:e.includes("sepolia")?{name:"Sepolia",chainId:"11155111"}:e.includes("etc.rivet.link")?{name:"Ethereum Classic",chainId:"61"}:{name:"the selected network",chainId:"unknown"},{name:t,chainId:n}=e(this.networkUri);throw new Error(`Failed to interact with Djed contract at ${this.djedAddress} on ${t}.\n\nPossible causes:\n- The contract address may be incorrect\n- The contract may not be deployed on ${t}\n- The contract may not be a valid Djed contract\n\nPlease verify the contract address is correct for ${t} (Chain ID: ${n}).`)}throw e}}catch(e){if(console.error("[Transaction] Error initializing transaction:",e),e.message&&(e.message.includes("CONNECTION ERROR")||e.message.includes("ERR_NAME_NOT_RESOLVED"))){const e=(e=>e.includes("milkomeda")?"Milkomeda":e.includes("mordor")?"Mordor":e.includes("sepolia")?"Sepolia":"the selected network")(this.networkUri);throw new Error(`Failed to connect to ${e} RPC endpoint: ${this.networkUri}\n\nPossible causes:\n- The RPC endpoint may be temporarily unavailable\n- DNS resolution issue (check your internet connection)\n- Network firewall blocking the connection\n\nPlease try again in a few moments or check the network status.`)}throw e}}getBlockchainDetails(){return{web3Available:!!this.web3,djedContractAvailable:!!this.djedContract,stableCoinAddress:this.stableCoin?this.stableCoin._address:"N/A",reserveCoinAddress:this.reserveCoin?this.reserveCoin._address:"N/A",stableCoinDecimals:this.scDecimals,reserveCoinDecimals:this.rcDecimals,oracleAddress:this.oracleAddress||"N/A",oracleContractAvailable:!!this.oracleContract}}async handleTradeDataBuySc(e){if(!this.djedContract)throw new Error("DJED contract is not initialized");if("string"!=typeof e)throw new Error("Amount must be a string");try{return(await i(this.djedContract,this.scDecimals,e)).totalBCScaled}catch(e){throw console.error("Error fetching trade data for buying stablecoins: ",e),e}}async buyStablecoins(e,t,n){if(!this.djedContract)throw new Error("DJED contract is not initialized");try{const r="0x0232556C83791b8291E9b23BfEa7d67405Bd9839";return await s(this.djedContract,e,t,n,r,this.djedAddress)}catch(e){throw console.error("Error executing buyStablecoins transaction: ",e),e}}}var T="main_stablePayButton__UA7HC",S="main_logo__ITyEy",A="main_buttonText__N-ewy";const D=({onClick:e,size:t="medium"})=>{const n={small:{width:"200px",height:"50px",fontSize:"14px"},medium:{width:"250px",height:"60px",fontSize:"16px"},large:{width:"300px",height:"70px",fontSize:"18px"}},r={small:{width:"35px",height:"33px"},medium:{width:"40px",height:"38px"},large:{width:"45px",height:"43px"}},a=n[t]||n.medium,o=r[t]||r.medium;return c.createElement("button",{className:T,onClick:e,style:a},c.createElement("div",{className:S,style:o}),c.createElement("span",{className:A},"Pay with StablePay"))};var x={dialogOverlay:"PricingCard_dialogOverlay__0XJrE",pricingCard:"PricingCard_pricingCard__LrWb9",small:"PricingCard_small__J4CHj",medium:"PricingCard_medium__EVmTB",large:"PricingCard_large__A6pnX",dialogClose:"PricingCard_dialogClose__jJ1tM",pricingCardHeader:"PricingCard_pricingCardHeader__wGczA",allianceLogo:"PricingCard_allianceLogo__URa-U",stablepayTitle:"PricingCard_stablepayTitle__4t848",pricingCardBody:"PricingCard_pricingCardBody__0wKQn",selectField:"PricingCard_selectField__LBPoZ",transactionReview:"PricingCard_transactionReview__Ix-eL",transactionInfo:"PricingCard_transactionInfo__Ck-Rc",transactionLabel:"PricingCard_transactionLabel__GDux7",transactionValue:"PricingCard_transactionValue__q-xxp",infoSection:"PricingCard_infoSection__gyjMQ",infoIcon:"PricingCard_infoIcon__rraxD",infoText:"PricingCard_infoText__l4b7A",walletButton:"PricingCard_walletButton__llw4v",loading:"PricingCard_loading__2-tGA",error:"PricingCard_error__m5fK-",networkError:"PricingCard_networkError__zR-36",errorText:"PricingCard_errorText__qZRJt","message-box":"PricingCard_message-box__vkUKy",detailsButton:"PricingCard_detailsButton__jHglL",errorDetails:"PricingCard_errorDetails__CzN-7",loadingContainer:"PricingCard_loadingContainer__6nOVa",spinner:"PricingCard_spinner__9ucQv",spin:"PricingCard_spin__24tni"};const P=({children:e,onClose:t,size:n="medium"})=>c.createElement("div",{className:x.dialogOverlay},c.createElement("div",{className:`${x.pricingCard} ${x[n]}`},c.createElement("button",{className:x.dialogClose,onClick:t},"×"),c.createElement("div",{className:x.pricingCardHeader},c.createElement("div",{className:x.allianceLogo}),c.createElement("h2",{className:x.stablepayTitle},"StablePay")),c.createElement("div",{className:x.pricingCardBody},e)));class I{constructor(e){this.networkSelector=e,this.selectedToken=null}selectToken(e){const t=this.networkSelector.getSelectedNetworkConfig();return!(!t||!t.tokens[e])&&(this.selectedToken={key:e,...t.tokens[e]},!0)}getSelectedToken(){return this.selectedToken}getAvailableTokens(){const e=this.networkSelector.getSelectedNetworkConfig();return e?Object.entries(e.tokens).map((([e,t])=>({key:e,...t}))):[]}resetSelection(){this.selectedToken=null}}const B=d(),M=({children:e,networkSelector:t})=>{const[n]=m((()=>new I(t))),[r,a]=m(null),[o,i]=m(null),[s,l]=m(null),d=()=>{i(null),l(null)};return u((()=>{a(t.selectedNetwork)}),[t.selectedNetwork]),c.createElement(B.Provider,{value:{networkSelector:t,tokenSelector:n,selectedNetwork:r,selectedToken:o,transactionDetails:s,setTransactionDetails:l,selectNetwork:e=>!!t.selectNetwork(e)&&(a(e),d(),!0),selectToken:e=>{if(n.selectToken(e)){const e=n.getSelectedToken();return i(e),!0}return!1},resetSelections:()=>{t.selectNetwork(null),a(null),d()}}},e)},$=()=>{const e=l(B);if(void 0===e)throw new Error("useNetwork must be used within a NetworkProvider");return e},j=()=>{const{networkSelector:e,selectedNetwork:t,selectNetwork:n}=$();return c.createElement("div",{className:x.selectField},c.createElement("label",{htmlFor:"network-select"},"Select Network"),c.createElement("select",{id:"network-select",onChange:e=>{n(e.target.value)},value:t||""},c.createElement("option",{value:"",disabled:!0},"Select a network"),Object.keys(e.availableNetworks).map((e=>c.createElement("option",{key:e,value:e},e)))))},U=()=>{const{networkSelector:e,tokenSelector:t,selectedNetwork:n,selectedToken:r,selectToken:a,setTransactionDetails:o}=$(),[i,s]=m(!1),[l,d]=m(null),u=n?t.getAvailableTokens():[];return c.createElement("div",{className:x.selectField},c.createElement("label",{htmlFor:"token-select"},"Select Token"),c.createElement("select",{id:"token-select",onChange:async r=>{const i=r.target.value;d(null),s(!0);try{if(a(i)){const r=e.getSelectedNetworkConfig(),a=new N(r.uri,r.djedAddress);await a.init();const s=e.getTokenAmount(i),c=a.getBlockchainDetails();let l=null;"native"===i&&(l=await a.handleTradeDataBuySc(String(s))),o({network:n,token:i,tokenSymbol:t.getSelectedToken().symbol,amount:s,receivingAddress:e.getReceivingAddress(),djedContractAddress:r.djedAddress,isDirectTransfer:t.getSelectedToken().isDirectTransfer||!1,isNativeToken:t.getSelectedToken().isNative||!1,tradeAmount:l?l.amount:null,...c})}}catch(e){console.error("Error fetching transaction details:",e),d("Failed to fetch transaction details. Please try again.")}finally{s(!1)}},value:r?r.key:"",disabled:!n||i},c.createElement("option",{value:"",disabled:!0},n?i?"Loading...":"Select a token":"Please select a network first"),u.map((e=>c.createElement("option",{key:e.key,value:e.key},e.symbol," (",e.isDirectTransfer?"Direct Transfer":"Native",")")))),l&&c.createElement("div",{className:x.error},l))};k({id:63,name:"Mordor Testnet",network:"mordor",nativeCurrency:{decimals:18,name:"Mordor Ether",symbol:"METC"},rpcUrls:{default:{http:["https://rpc.mordor.etccooperative.org"],webSocket:["wss://rpc.mordor.etccooperative.org/ws"]}},blockExplorers:{default:{name:"BlockScout",url:"https://blockscout.com/etc/mordor"}},testnet:!0});const F=k({id:2001,name:"Milkomeda C1 Mainnet",network:"milkomeda",nativeCurrency:{decimals:18,name:"Milkomeda ADA",symbol:"mADA"},rpcUrls:{default:{http:["https://rpc-mainnet-cardano-evm.c1.milkomeda.com"]}},blockExplorers:{default:{name:"Milkomeda Explorer",url:"https://explorer-mainnet-cardano-evm.c1.milkomeda.com"}},testnet:!1}),R=k({id:61,name:"Ethereum Classic",network:"etc",nativeCurrency:{decimals:18,name:"Ethereum Classic",symbol:"ETC"},rpcUrls:{default:{http:["https://etc.rivet.link"]}},blockExplorers:{default:{name:"Blockscout",url:"https://blockscout.com/etc/mainnet"}},testnet:!1}),L=d(null),z=async e=>{if(!window.ethereum)throw new Error("MetaMask not installed");const t=(e=>{switch(e){case"sepolia":return{chainId:`0x${y.id.toString(16)}`,chainName:"Sepolia",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:y.rpcUrls.default.http,blockExplorerUrls:y.blockExplorers?.default?.url?[y.blockExplorers.default.url]:[]};case"ethereum-classic":return{chainId:`0x${R.id.toString(16)}`,chainName:"Ethereum Classic",nativeCurrency:{name:"Ethereum Classic",symbol:"ETC",decimals:18},rpcUrls:["https://etc.rivet.link"],blockExplorerUrls:["https://blockscout.com/etc/mainnet"]};case"milkomeda-mainnet":return{chainId:`0x${F.id.toString(16)}`,chainName:"Milkomeda C1 Mainnet",nativeCurrency:{name:"Milkomeda ADA",symbol:"mADA",decimals:18},rpcUrls:["https://rpc-mainnet-cardano-evm.c1.milkomeda.com"],blockExplorerUrls:["https://explorer-mainnet-cardano-evm.c1.milkomeda.com"]};default:return null}})(e);if(!t)throw new Error(`Unsupported network: ${e}`);try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:t.chainId}]})}catch(e){if(4902!==e.code)throw 4001===e.code?new Error(`User rejected switching to ${t.chainName}. Please switch manually in MetaMask.`):new Error(`Failed to switch to ${t.chainName}: ${e.message}`);try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[t]})}catch(e){if(4001===e.code)throw new Error(`User rejected adding ${t.chainName} to MetaMask. Please add it manually.`);throw new Error(`Failed to add ${t.chainName} to MetaMask: ${e.message}`)}}},W=({children:e})=>{const{selectedNetwork:t}=$(),[n,r]=m(null),[a,o]=m(null),[i,s]=m(null),[l,d]=m(null),[k,f]=m(null),[v,E]=m(null),[_,N]=m(!1),T=t?(e=>{switch(e){case"sepolia":return y;case"ethereum-classic":return R;case"milkomeda-mainnet":return F;default:return null}})(t):null,S=T?T.id:null,A=h(null),D=h(null),x=w((()=>{r(null),o(null),s(null),d(null),f(null),E(null)}),[]),P=w((async e=>{const n=parseInt(e,16);if(d(n),T&&n===S){if(E(null),window.ethereum&&T){const e=g({chain:T,transport:C(window.ethereum)});r(e)}}else if(T&&n!==S){E(`Wrong network detected. Please switch to ${T?.name||t||"selected network"}`)}}),[T,S,t]);D.current=P;const I=w((async e=>{if(0===e.length){if(x(),window.ethereum){const e=A.current,t=D.current;e&&window.ethereum.removeListener("accountsChanged",e),t&&window.ethereum.removeListener("chainChanged",t)}}else if(s(e[0]),T)try{const t=p({chain:T,transport:b()});o(t);const n=await t.getBalance({address:e[0]});f(parseFloat(n)/Math.pow(10,18))}catch(e){console.error("Error fetching balance:",e),f(null)}}),[T,x]);A.current=I;const B=w((()=>{if(x(),window.ethereum){const e=A.current,t=D.current;e&&window.ethereum.removeListener("accountsChanged",e),t&&window.ethereum.removeListener("chainChanged",t)}}),[x]),M=w((()=>{T&&o(p({chain:T,transport:b()}))}),[T]),j=w((async()=>{if(!window.ethereum)return E("Please install MetaMask or another Web3 wallet"),!1;if(!t||!T)return E("Please select a network first"),!1;N(!0),E(null);try{const e=await window.ethereum.request({method:"eth_requestAccounts"});if(0===e.length)throw new Error("No wallet address found. Please unlock your wallet.");const n=await window.ethereum.request({method:"eth_chainId"});parseInt(n,16)!==S&&await z(t);const a=g({chain:T,transport:C(window.ethereum)});r(a),s(e[0]),d(S);const i=p({chain:T,transport:b()});o(i);try{const t=await i.getBalance({address:e[0]});f(parseFloat(t)/Math.pow(10,18))}catch(e){console.error("Error fetching balance:",e),f(null)}return A.current=I,D.current=P,window.ethereum.on("accountsChanged",I),window.ethereum.on("chainChanged",P),!0}catch(e){return console.error("Error connecting wallet:",e),E(e.message),!1}finally{N(!1)}}),[t,T,S,I,P]),U=w((async()=>{if(!(window.ethereum&&t&&T&&i)){return E("Wallet not connected or network not selected"),null}try{const e=await window.ethereum.request({method:"eth_chainId"});if(parseInt(e,16)!==S){E(null),await z(t);const e=500;await new Promise((t=>setTimeout(t,e)));const n=await window.ethereum.request({method:"eth_chainId"}),r=parseInt(n,16);if(r!==S)throw new Error(`Failed to switch network. MetaMask is still on chain ${r}, expected ${S}`)}const n=g({chain:T,transport:C(window.ethereum)});return r(n),d(S),E(null),n}catch(e){return E(e.message),null}}),[t,T,S,i]),W=h(t);return u((()=>{if(null!==W.current&&W.current!==t&&i&&(x(),window.ethereum)){const e=A.current,t=D.current;e&&window.ethereum.removeListener("accountsChanged",e),t&&window.ethereum.removeListener("chainChanged",t)}W.current=t}),[t,i,x]),u((()=>{M()}),[M]),c.createElement(L.Provider,{value:{walletClient:n,publicClient:a,account:i,chainId:l,balance:k,error:v,isConnecting:_,connectWallet:j,disconnectWallet:B,ensureCorrectNetwork:U,expectedChainId:S}},e)},O=({onTransactionComplete:e})=>{const{networkSelector:t,selectedNetwork:n,selectedToken:r,transactionDetails:a,setTransactionDetails:o}=$(),{connectWallet:i,account:s,walletClient:d,publicClient:h,isConnecting:w,ensureCorrectNetwork:k,expectedChainId:g}=(()=>{const e=l(L);if(!e)throw new Error("useWallet must be used within a WalletProvider");return e})(),[C,p]=m(null),[b,y]=m(null),[_,T]=m(null),[S,A]=m(""),[D,P]=m(null),[I,B]=m(null),[M,j]=m(!1);if(u((()=>{T(null),y(null),A(""),B(null),P(null)}),[n,r]),u((()=>{(async()=>{if(n&&r)try{const e=t.getSelectedNetworkConfig(),a=t.getReceivingAddress(),i=t.getTokenAmount(r.key),s=new N(e.uri,e.djedAddress);await s.init(),p(s);let c=null;if("native"===r.key)try{c=await s.handleTradeDataBuySc(String(i)),y(c)}catch(e){console.error("Error fetching trade data:",e)}o({network:n,token:r.key,tokenSymbol:r.symbol,amount:i||"0",receivingAddress:a,djedContractAddress:e.djedAddress,isDirectTransfer:r.isDirectTransfer||!1,isNativeToken:r.isNative||!1,tradeAmount:c?c.amount:null,...s.getBlockchainDetails()})}catch(e){console.error("Error initializing transaction:",e)}})()}),[n,r,t,o]),!a)return c.createElement("div",{className:x.loading},"Initializing transaction...");const U=()=>{if(!D||!n)return null;const e={"ethereum-classic":"https://blockscout.com/etc/mainnet/tx/",sepolia:"https://sepolia.etherscan.io/tx/","milkomeda-mainnet":"https://explorer-mainnet-cardano-evm.c1.milkomeda.com/tx/"};return e[n]?`${e[n]}${D}`:null};return c.createElement("div",{className:x.transactionReview},c.createElement("div",{className:x.transactionInfo},c.createElement("span",{className:x.transactionLabel},"Network:"),c.createElement("span",{className:x.transactionValue},a.network)),c.createElement("div",{className:x.transactionInfo},c.createElement("span",{className:x.transactionLabel},"You Pay:"),c.createElement("span",{className:x.transactionValue},"stablecoin"===r.key?`${a.amount} ${a.tokenSymbol}`:`${b||"Calculating..."} ${a.tokenSymbol}`)),c.createElement("button",{className:x.walletButton,onClick:async()=>{await i()},disabled:w},w?"Connecting...":"Connect Wallet"),s&&!_&&c.createElement("button",{className:x.walletButton,onClick:async()=>{if(s&&a&&C)try{T(null),B(null),A("⏳ Preparing transaction...");const e=a.receivingAddress;let n;if("native"===r.key){const t="0x0232556C83791b8291E9b23BfEa7d67405Bd9839",r=f(String(b||"0"));n=await C.buyStablecoins(s,e,r,t),n={...n,value:r,account:s}}else{const r=t.getSelectedNetworkConfig(),o=r?.tokens?.stablecoin?.address;if(!o)throw new Error("Stablecoin address not found in network configuration");const i=a.amount?v(String(a.amount),a.stableCoinDecimals):"0";n={to:o,value:0n,data:E({abi:[{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}],functionName:"transfer",args:[e,i]}),account:s}}T(n),A("✅ Transaction ready! Click 'Send Transaction' to proceed.")}catch(e){B(e),A("❌ Transaction preparation failed.")}else A("❌ Wallet not connected or transaction details missing")}},"Prepare Transaction"),s&&_&&c.createElement("button",{className:x.walletButton,onClick:async()=>{B(null);try{if(!s||!_)return void A("❌ Wallet account or transaction data is missing");if(!n)return void A("❌ Network not selected");const o=t.getSelectedNetworkConfig();if(!o)return void A("❌ Network configuration not found");A("⏳ Verifying network...");const i=await k();if(!i)return void A("❌ Failed to switch to correct network. Please approve the network switch in MetaMask and try again.");if(!window.ethereum)return void A("❌ MetaMask not available");const c=await window.ethereum.request({method:"eth_chainId"}),l=parseInt(c,16);if(l!==o.chainId){const e=`Network mismatch. MetaMask is on chain ${l}, but ${n} requires chain ${o.chainId}. Please switch networks in MetaMask.`;return A(`❌ ${e}`),void B(new Error(e))}if(i.chain.id!==o.chainId){const e=`Wallet client chain mismatch. Wallet client is on chain ${i.chain.id}, but expected ${o.chainId}.`;return A(`❌ ${e}`),void B(new Error(e))}A("⏳ Sending transaction...");const d=await i.sendTransaction({..._,account:s});P(d),A("✅ Transaction sent!"),e&&e({txHash:d,network:n,token:r?.key,tokenSymbol:r?.symbol,amount:a?.amount,receivingAddress:a?.receivingAddress})}catch(e){B(e),A("❌ Transaction failed."),console.error("Transaction error:",e)}},disabled:null!==D},"Send Transaction"),S&&c.createElement("div",{className:"message-box"},S,I&&c.createElement("button",{onClick:()=>j(!M),className:x.detailsButton},M?"Hide Details":"Show Details")),M&&I&&c.createElement("div",{className:x.errorDetails},c.createElement("pre",null,I.message)),D&&c.createElement("div",{className:x.transactionLink},"✅ Transaction Hash:"," ",U()?c.createElement("a",{href:U(),target:"_blank",rel:"noopener noreferrer",className:x.explorerLink,style:{color:"#007bff",textDecoration:"underline",fontWeight:"bold",cursor:"pointer",wordBreak:"break-word"}},D.slice(0,6),"...",D.slice(-6)):c.createElement("span",{style:{wordBreak:"break-word"}},D)))},q=({onClose:e,buttonSize:t,onTransactionComplete:n})=>{const{resetSelections:r}=$();return c.createElement(P,{onClose:()=>{r(),e()},size:t},c.createElement(j,null),c.createElement(U,null),c.createElement(O,{onTransactionComplete:n}))},H=({onClose:e,buttonSize:t,networkSelector:n,onTransactionComplete:r})=>c.createElement(M,{networkSelector:n},c.createElement(W,null,c.createElement(q,{onClose:e,buttonSize:t,onTransactionComplete:r}))),V={NetworkSelector:class{constructor(e){this.merchantConfig=e,this.blacklist=e.getBlacklist(),this.availableNetworks=this.getAvailableNetworks(),this.selectedNetwork=null}getAvailableNetworks(){return Object.entries(_).reduce(((e,[t,n])=>(this.blacklist.includes(n.chainId)||(e[t]=n),e)),{})}selectNetwork(e){return null===e?(this.selectedNetwork=null,console.log("Network selection reset"),!0):this.availableNetworks[e]?(this.selectedNetwork=e,console.log(`Network selected: ${e}`),!0):(console.error(`Invalid network: ${e}`),!1)}getSelectedNetworkConfig(){return this.selectedNetwork?this.availableNetworks[this.selectedNetwork]:null}getReceivingAddress(){return this.merchantConfig.getReceivingAddress()}getTokenAmount(e){return this.merchantConfig.getTokenAmount(this.selectedNetwork,e)}},Transaction:N,Config:class{constructor(e={}){this.receivingAddress=e.receivingAddress||"",this.blacklist=e.blacklist||[],this.amounts=e.Amounts||{},this.validateConfig()}validateConfig(){if(!this.receivingAddress)throw new Error("Receiving address is required");for(const[e,t]of Object.entries(this.amounts)){if(!_[e])throw new Error(`Invalid network: ${e}`);if(!t.stablecoin||"number"!=typeof t.stablecoin||t.stablecoin<=0)throw new Error(`Invalid stablecoin amount for network ${e}`)}}getBlacklist(){return this.blacklist}getReceivingAddress(){return this.receivingAddress}getTokenAmount(e){console.log("Getting amount for network:",e),console.log("Amounts object:",this.amounts);const t=this.amounts[e]?.stablecoin;return console.log("Returning amount:",t),t||0}},Widget:({networkSelector:e,buttonSize:t="medium",onTransactionComplete:n,onSuccess:r})=>{const[a,o]=m(!1),i=n||r;return c.createElement("div",{className:x.widgetContainer},!a&&c.createElement(D,{onClick:()=>{o(!0)},size:t}),a&&c.createElement(H,{onClose:()=>{o(!1)},buttonSize:t,networkSelector:e,onTransactionComplete:i}))},PayButton:D,Dialog:P,NetworkDropdown:j};export{V as default};
